var admin=function(t){function e(){return t("body").hasClass("modal-open")}function i(){return t("input").is(":focus")}function n(){t(document).on("click",".tr-activity",function(e){var i=t(e.target||e.srcElement||e.originalTarget),n=t(this);i.attr("href")||i.hasClass("glyphicon-ok")||window.open(n.find(".view-report").attr("href"),"_self"),i.hasClass("approve-report")||n.find(".assign-report").length>0&&n.find(".assign-report").trigger("click")})}function o(){t(document).on("click",".approve-report",function(e){e.preventDefault();var i="Loading...",n='<i class="glyphicon glyphicon-alert"></i>',o=t(this);o.html(i);var a=o.attr("href")||"#";t.ajax({url:baseUrl+a,method:"GET",dataType:"json"}).done(function(t){var e=o.closest("tr"),i=e.find("td");t.success?(i.slideUp(),e.slideUp()):(e.addClass("alert-danger"),o.html(n))})})}function a(){t(document).on("click",".approve-comment",function(e){e.preventDefault();var i="Loading...",n='<i class="glyphicon glyphicon-alert"></i>',o=t(this);o.html(i);var a=o.attr("href")||"#";t.ajax({url:baseUrl+a,method:"GET",dataType:"json"}).done(function(t){var e=o.closest("[data-key]");t.success?e.slideUp():(e.addClass("alert-danger"),o.html(n))})})}function s(){function n(){e()||i()||t("#hotkeysModal").modal()}if(keyboardJS.bind("?",n),keyboardJS.bind("shift + ,",n),t(".report-full").length>0){var o={s:".btn-change-status",e:".btn-edit",m:".btn-send-report",u:".btn-upload-answer",x:".btn-delete",o:"#report-unique-name-link"};t.each(o,function(n,o){keyboardJS.bind(n,function(){e()||i()||t(o)[0].click()})})}}return{init:function(){t('[data-toggle="tooltip"]').tooltip(),s(),n(),o(),a(),t(".modal").on("shown.bs.modal",function(){window.mapInitData&&JarokeloMap.showPlace()})}}}($);$(document).ready(function(){admin.init(),Dropzone.autoDiscover=!1}),function(t,e){return t.extend(e,{City:{init:function(){t(document).on("select2:select",".load-institution-contacts",function(i){var n=t(this),o=n.data("url");n.data("url",o.replace("ph",i.params.data.id)),t(".show-on-contact-load").addClass("hidden"),t(".institution-note").addClass("hidden"),t(".contact-container").html(""),t(".institution-note-container").html(""),e.Helper.queryHtmlContent(n,i,function(e){if(n.data("url",o),t(".show-on-contact-load").removeClass("hidden"),e){if(e.note=e.note||"",""===e.note)return;t(".institution-note").removeClass("hidden"),t(".institution-note-container").html(e.note)}})})}}})}($,admin||{}),$(document).ready(function(){admin.City.init()}),function(t,e){return t.extend(e,{Comment:{init:function(){t(".comment__text").length&&t(".comment__text").each(function(){t(this).text().length>160&&t(this).siblings(".comment__more").show()}),t(document).on("click",".comment__more",function(){var e=t(this);e.siblings(".comment__text").toggleClass("comment__text--full"),e.hide(),e.siblings(".comment__less").show()}),t(document).on("click",".comment__less",function(){var e=t(this);e.siblings(".comment__text").toggleClass("comment__text--full"),e.hide(),e.siblings(".comment__more").show()})}}})}($,admin||{}),$(document).ready(function(){admin.Comment.init()}),function(t,e){var i=[{selector:"#statuschange-solutiondate-kvdate",status:[8],hidden:!0},{selector:"#statuschange-reason",status:[6],hidden:!0},{selector:"#statuschange-comment",status:[5,6],hidden:!0},{selector:"#hidden-status-desc",status:[0,1],hidden:!0}];return t.extend(e,{Helper:{queryHtmlContent:function(e,i,n,o){var a=e.data("url"),s=t(e.data("target")),r=e.data("extra")||"";return t.ajax({method:"get",url:a+r,success:function(t){t&&t.success?(t.html&&s.html(t.html),n&&n(t)):o&&o(t)}}),i&&i.preventDefault(),!1},postData:function(e,i,n,o,a){var s=e.data("url");return t.ajax({method:"post",url:s,data:i,success:function(t){t&&t.success?o&&o(t):a&&a(t)}}),n&&n.preventDefault(),!1},statusChange:function(e){for(var n=0;n<i.length;++n){var o=i[n],a=o.status.indexOf(Number(e))!==-1;if(!(a&&!o.hidden||!a&&o.hidden)){var s=t(o.selector).parent();o.hidden?s.removeClass("hidden"):s.addClass("hidden"),o.hidden=!o.hidden}}}}})}($,admin||{}),function(t,e){return t.extend(e,{Modal:{init:function(){t(document).on("click",".btn-modal-content",function(i){var n=t(this);return e.Helper.queryHtmlContent(n,i,function(){t(n.data("modal")).modal("show")})}),t(document).on("change",".change-pjax-submit input, .change-pjax-submit select",function(){t(this).closest(".change-pjax-submit").submit()}),t(document).on("keyup",".change-pjax-submit input[type=text]",function(){t(this).closest(".change-pjax-submit").submit()}),t(document).on("pjax:end",".pjax-hide-modal",function(e,i,n){var o=t(n.target).attr("id"),a=t(this).data("pjax-target");a&&o!==a||t(t(this).data("modal")).modal("hide")}),t(document).on("pjax:end","#city-streets",function(e,i,n){var o=t(n.target).attr("id");"street-create-ajax"===o&&t("#street-grid-view-search").submit()}),t(document).on("pjax:end",".pjax-reload-other-pjax",function(e,i,n){t.pjax.reload({url:n.requestUrl,container:t(this).data("reload-pjax-selector"),async:!1,push:!1,replace:!1,scrollTo:!1,timeout:1e3})}),t(document).on("click",".btn-pjax-research",function(i){var n=t(this);return n.data("url",n.attr("href")),e.Helper.postData(n,null,i,function(){t(n.data("search-form")).submit(),t(n.data("modal")).modal("hide")})}),t(document).on("click",".btn-pjax-delete-confirm",function(i){var n=t(this);return n.data("url",n.attr("href")),e.Helper.postData(n,null,i,function(){t.pjax({container:n.data("pjax-container")}),t(n.data("modal")).modal("hide")})}),t(document).on("click",".btn-reload-pjax-submit",function(i){var n=t(this),o=n.closest("form");return n.data("form")&&(o=t(n.data("form"))),e.Helper.postData(n,o.serializeArray(),i,function(){t.pjax({container:n.data("pjax-container")}),n.data("modal")&&t(n.data("modal")).modal("hide")})})}}})}($,admin||{}),$(document).ready(function(){admin.Modal.init()}),function(t,e){"use strict";function i(){t(".gallery").lightGallery({selector:".lightbox",animateThumb:!1,showThumbByDefault:!1}),t(document).on("change","#statuschange-status",function(){e.Helper.statusChange(t(this).val())}),e.Helper.statusChange(t("#statuschange-status").val()),t(document).on("change","#street-postcode",function(){var e=t(this).val();if("string"==typeof e){var i=t("#street-district_id"),n=i.find("option[data-number="+parseInt(e.substr(1,2),10)+"]").val();i.val(n).trigger("change")}}),t(document).on("select2:select",".load-institution-note",function(i){var n=t(this),o=n.data("url");n.data("url",o.replace("ph",i.params.data.id)),t(".institution-note").addClass("hidden"),t(".institution-note-container").html(""),e.Helper.queryHtmlContent(n,i,function(e){if(n.data("url",o),e){if(e.note=e.note||"",""===e.note)return;t(".institution-note").removeClass("hidden"),t(".institution-note-container").html(e.note+"<br><br>")}})}),t(document).on("click",".btn-toggle-comment",function(i){var n=t(this);e.Helper.queryHtmlContent(n,i,function(t){if(t){if(t.label=t.label||"",""===t.label)return;n.html(t.label)}})}),t(document).on("click","#send-form-add-contact",function(i){var n=t(this);e.Helper.queryHtmlContent(t(this),i,function(e){if(e){if(e.fieldHtml=e.fieldHtml||"",""===e.fieldHtml)return;var i=n.closest(".modal-body"),o=t(e.fieldHtml);i.hasClass("test-send")?o.find("input[type=hidden]").val(1):o.find("input[type=hidden]").val(0),i.find(".extra-contacts").append(o)}})}),t(document).on("click",".remove-extra-contact",function(e){e&&e.preventDefault(),t(this).closest("div.extra-contact").remove()}),t(document).on("click","#toggle-test-send",function(e){e&&e.preventDefault();var i=t(".test-send"),n=t(".real-send");i.hasClass("hidden")?(n.addClass("hidden"),i.removeClass("hidden"),t("#sendform-test").val(1)):(i.addClass("hidden"),n.removeClass("hidden"),t("#sendform-test").val(0))}),t(document).on("click",".au-delete-button-static",function(e){e&&e.preventDefault(),t(this).closest(".attachment-entry").remove()}),t(document).on("click","#next",function(e){e&&e.preventDefault(),t("#step1").addClass("hidden"),t("#step2").removeClass("hidden"),t("#next").addClass("hidden"),t("#submit").removeClass("hidden")})}return t.extend(e,{Report:{mapData:[],init:function(){i()},initMap:function(){t.extend(this.mapData,{draggable:!("ontouchend"in document),scrollwheel:!1});var e=new google.maps.Map(t(".report__map")[0],this.mapData);new google.maps.Marker({title:this.mapData.title,position:{lat:this.mapData.center.lat,lng:this.mapData.center.lng},map:e})}}})}($,admin||{}),$(document).ready(function(){admin.Report.init()}),function(t,e){function i(){var e=t("#quick-search-dropdown"),i=t(".quick-search-container");e.addClass("hidden"),i.html("")}return t.extend(e,{QuickSearch:{init:function(){t(document).on("keyup","#quick-search input",function(){var e=t("#quick-search-dropdown"),n=t(".quick-search-container"),o=t(this),a=o.val();if(0===a.length)return i(),!0;if(a.length<3)return!0;var s=e.data("timeout");return s&&clearTimeout(s),e.data("timeout",setTimeout(function(){e.data("timeout",null),t.get(e.data("url"),o.closest("form").serialize(),function(o){o&&o.success?(n.html(o.html),n.find(".quick-search-row").click(function(e){document.location.href=t(e.currentTarget).data("href")}),e.removeClass("hidden")):i()})},350)),!0}),t(document).on("blur","#quick-search input",function(){setTimeout(function(){i()},350)})}}})}($,admin||{}),$(document).ready(function(){admin.QuickSearch.init()}),function(t,e){var i,n=new WebSocket(webSocketUrl),o=function(t,e){t.tooltip({title:"Currently edited by "+e})},a=function(){if(t(".update-report-form").length){var e=t("#reportId").val(),i=t("#adminId").val();setTimeout(function(){n.send(JSON.stringify({event:"lock",adminId:i,reportId:e}))},1e3)}},s=function(e,n){if(0!==e)for(var a;e--;){a=i[e];var s=t('[data-report-id="'+a.reportId+'"]');"unlock"!==n?(s.attr("disabled",!0),s.data("href",s.attr("href")).removeAttr("href"),o(s,a.adminName)):(s.attr("disabled",!1),s.attr("href",s.data("href")),s.tooltip("destroy"))}},r=function(e,n){if(0!==e)for(var a;e--;){a=i[e];var s=t('[data-report-id="'+a.reportId+'"]'),r=s.find("a");"unlock"!==n?(s.addClass("is-disabled"),r.data("href",r.attr("href")).removeAttr("href"),o(s,a.adminName)):(s.removeClass("is-disabled"),r.attr("href",r.data("href")),s.tooltip("destroy"))}},h=function(){(t("#report-grid").length||t("#new").length||t(".report-view-page").length)&&(n.onmessage=function(e){var n=JSON.parse(e.data);if(i=[],n.hasOwnProperty("lockedReports")){if(n.lockedReports.length)for(var o=n.lockedReports.length;o--;){var a=n.lockedReports[o];i.push(a)}}else i.push(n);t(".report-view-page").length?s(i.length,n.event):r(i.length,n.event)})};return t.extend(e,{Websocket:{init:function(){a(),h()}}})}($,admin||{}),$(document).ready(function(){admin.Websocket.init()}),function(){"use strict";var t=Darkroom.Transformation.extend({applyTransformation:function(t,e,i){var n=new Image;n.onload=function(){if(!(a<1||o<1)){var n=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),o=this.width,a=this.height;t.setWidth(o),t.setHeight(a),e.remove(),t.add(n),i(n)}};var o=Darkroom.Utils.computeImageViewPort(e),a=o.width,s=o.height,r=this.options.left*a,h=this.options.top*s,d=Math.min(this.options.width*a,a-r),c=Math.min(this.options.height*s,s-h),l=new fabric.Rect({width:d,height:c,left:r,top:h,fill:"#000"});t.add(l),t.renderAll(),n.src=t.toDataURL()}}),e=fabric.util.createClass(fabric.Rect,{_render:function(t){this.callSuper("_render",t);var e=(t.canvas,7),i=this.flipX?-1:1,n=this.flipY?-1:1,o=i/this.scaleX,a=n/this.scaleY;t.scale(o,a),void 0!==t.setLineDash?t.setLineDash([e,e]):void 0!==t.mozDash&&(t.mozDash=[e,e]),t.strokeStyle="rgba(0, 0, 0, 0.2)",this._renderBorders(t),t.lineDashOffset=e,t.strokeStyle="rgba(255, 255, 255, 0.4)",this._renderBorders(t),t.scale(1/o,1/a)},_renderOverlay:function(t){var e=t.canvas,i=0,n=Math.ceil(-this.getWidth()/2-this.getLeft()),o=Math.ceil(-this.getWidth()/2),a=Math.ceil(this.getWidth()/2),s=Math.ceil(this.getWidth()/2+(e.width-this.getWidth()-this.getLeft())),r=Math.ceil(-this.getHeight()/2-this.getTop()),h=Math.ceil(-this.getHeight()/2),d=Math.ceil(this.getHeight()/2),c=Math.ceil(this.getHeight()/2+(e.height-this.getHeight()-this.getTop()));t.fillRect(n,r,s-n,h-r+i),t.fillRect(n,h,o-n,d-h+i),t.fillRect(a,h,s-a,d-h+i),t.fillRect(n,d,s-n,c-d)},_renderBorders:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,-this.getHeight()/2),t.stroke()},_renderGrid:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.stroke()}});Darkroom.plugins.box=Darkroom.Plugin.extend({startX:null,startY:null,isKeyBoxing:!1,isKeyLeft:!1,isKeyUp:!1,defaults:{minHeight:1,minWidth:1,ratio:null,quickBoxKey:!1},initialize:function(){var t=this.darkroom.toolbar.createButtonGroup();this.boxButton=t.createButton({image:"box"}),this.okButton=t.createButton({image:"done",type:"success",hide:!0}),this.cancelButton=t.createButton({image:"close",type:"danger",hide:!0}),this.boxButton.addEventListener("click",this.toggleBox.bind(this)),this.okButton.addEventListener("click",this.boxCurrentZone.bind(this)),this.cancelButton.addEventListener("click",this.releaseFocus.bind(this)),this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this)),this.darkroom.canvas.on("mouse:move",this.onMouseMove.bind(this)),this.darkroom.canvas.on("mouse:up",this.onMouseUp.bind(this)),this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this)),this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this)),fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(fabric.document,"keyup",this.onKeyUp.bind(this)),this.darkroom.addEventListener("core:transformation",this.releaseFocus.bind(this))},onObjectMoving:function(t){if(this.hasFocus()){var e=t.target;if(e===this.boxZone){var i=this.darkroom.canvas,n=e.getLeft(),o=e.getTop(),a=e.getWidth(),s=e.getHeight(),r=i.getWidth()-a,h=i.getHeight()-s;n<0&&e.set("left",0),o<0&&e.set("top",0),n>r&&e.set("left",r),o>h&&e.set("top",h),this.darkroom.dispatchEvent("box:update")}}},onObjectScaling:function(t){if(this.hasFocus()){var e=!1,i=t.target;if(i===this.boxZone){var n=this.darkroom.canvas,o=n.getPointer(t.e),a=(o.x,o.y,i.getLeft()),s=i.getTop(),r=i.getLeft()+i.getWidth(),h=i.getTop()+i.getHeight();if(null!==this.options.ratio&&(a<0||r>n.getWidth()||s<0||h>n.getHeight())&&(e=!0),a<0||r>n.getWidth()||e){var d=this.lastScaleX||1;i.setScaleX(d)}if(a<0&&i.setLeft(0),s<0||h>n.getHeight()||e){var c=this.lastScaleY||1;i.setScaleY(c)}s<0&&i.setTop(0),i.getWidth()<this.options.minWidth&&i.scaleToWidth(this.options.minWidth),i.getHeight()<this.options.minHeight&&i.scaleToHeight(this.options.minHeight),this.lastScaleX=i.getScaleX(),this.lastScaleY=i.getScaleY(),this.darkroom.dispatchEvent("box:update")}}},onMouseDown:function(t){if(this.hasFocus()){var e=this.darkroom.canvas;e.calcOffset();var i=e.getPointer(t.e),n=i.x,o=i.y,a=new fabric.Point(n,o),s=e.getActiveObject();s===this.boxZone||this.boxZone.containsPoint(a)||(e.discardActiveObject(),this.boxZone.setWidth(0),this.boxZone.setHeight(0),this.boxZone.setScaleX(1),this.boxZone.setScaleY(1),this.startX=n,this.startY=o)}},onMouseMove:function(t){if(this.isKeyBoxing)return this.onMouseMoveKeyBox(t);if(null!==this.startX&&null!==this.startY){var e=this.darkroom.canvas,i=e.getPointer(t.e),n=i.x,o=i.y;this._renderBoxZone(this.startX,this.startY,n,o)}},onMouseMoveKeyBox:function(t){var e=this.darkroom.canvas,i=this.boxZone,n=e.getPointer(t.e),o=n.x,a=n.y;i.left&&i.top||(i.setTop(a),i.setLeft(o)),this.isKeyLeft=o<i.left+i.width/2,this.isKeyUp=a<i.top+i.height/2,this._renderBoxZone(Math.min(i.left,o),Math.min(i.top,a),Math.max(i.left+i.width,o),Math.max(i.top+i.height,a))},onMouseUp:function(t){if(null!==this.startX&&null!==this.startY){var e=this.darkroom.canvas;this.boxZone.setCoords(),e.setActiveObject(this.boxZone),e.calcOffset(),this.startX=null,this.startY=null}},onKeyDown:function(t){!1===this.options.quickBoxKey||t.keyCode!==this.options.quickBoxKey||this.isKeyBoxing||(this.isKeyBoxing=!0,this.darkroom.canvas.discardActiveObject(),this.boxZone.setWidth(0),this.boxZone.setHeight(0),this.boxZone.setScaleX(1),this.boxZone.setScaleY(1),this.boxZone.setTop(0),this.boxZone.setLeft(0))},onKeyUp:function(t){!1!==this.options.quickBoxKey&&t.keyCode===this.options.quickBoxKey&&this.isKeyBoxing&&(this.isKeyBoxing=!1,this.startX=1,this.startY=1,this.onMouseUp())},selectZone:function(t,e,i,n,o){this.hasFocus()||this.requireFocus(),o?this.boxZone.set({left:t,top:e,width:i,height:n}):this._renderBoxZone(t,e,t+i,e+n);var a=this.darkroom.canvas;a.bringToFront(this.boxZone),this.boxZone.setCoords(),a.setActiveObject(this.boxZone),a.calcOffset(),this.darkroom.dispatchEvent("box:update")},toggleBox:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},boxCurrentZone:function(){if(this.hasFocus()&&!(this.boxZone.width<1&&this.boxZone.height<1)){var e=this.darkroom.image,i=this.boxZone.getTop()-e.getTop(),n=this.boxZone.getLeft()-e.getLeft(),o=this.boxZone.getWidth(),a=this.boxZone.getHeight();i<0&&(a+=i,i=0),n<0&&(o+=n,n=0),this.darkroom.applyTransformation(new t({top:i/e.getHeight(),left:n/e.getWidth(),width:o/e.getWidth(),height:a/e.getHeight()}))}},hasFocus:function(){return void 0!==this.boxZone},requireFocus:function(){this.boxZone=new e({fill:"black",hasBorders:!1,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1}),null!==this.options.ratio&&this.boxZone.set("lockUniScaling",!0),this.darkroom.canvas.add(this.boxZone),this.darkroom.canvas.defaultCursor="crosshair",this.boxButton.active(!0),this.okButton.hide(!1),this.cancelButton.hide(!1)},releaseFocus:function(){void 0!==this.boxZone&&(this.boxZone.remove(),this.boxZone=void 0,this.boxButton.active(!1),this.okButton.hide(!0),this.cancelButton.hide(!0),this.darkroom.canvas.defaultCursor="default",this.darkroom.dispatchEvent("box:update"))},_renderBoxZone:function(t,e,i,n){var o=this.darkroom.canvas,a=i>t,s=!a,r=n>e,h=!r,d=Math.min(+this.options.minWidth,o.getWidth()),c=Math.min(+this.options.minHeight,o.getHeight()),l=Math.min(t,i),u=Math.max(t,i),g=Math.min(e,n),m=Math.max(e,n);l=Math.max(0,l),u=Math.min(o.getWidth(),u),g=Math.max(0,g),m=Math.min(o.getHeight(),m),u-l<d&&(a?u=l+d:l=u-d),m-g<c&&(r?m=g+c:g=m-c),l<0&&(u+=Math.abs(l),l=0),u>o.getWidth()&&(l-=u-o.getWidth(),u=o.getWidth()),g<0&&(m+=Math.abs(g),g=0),m>o.getHeight()&&(g-=m-o.getHeight(),m=o.getHeight());var f=u-l,p=m-g,v=f/p;if(this.options.ratio&&+this.options.ratio!==v){var b=+this.options.ratio;if(this.isKeyBoxing&&(s=this.isKeyLeft,h=this.isKeyUp),v<b){var x=p*b;s&&(l-=x-f),f=x}else if(v>b){var k=p/(b*p/f);h&&(g-=k-p),p=k}if(l<0&&(l=0),g<0&&(g=0),l+f>o.getWidth()){var x=o.getWidth()-l;p=x*p/f,f=x,h&&(g=e-p)}if(g+p>o.getHeight()){var k=o.getHeight()-g;f=f*k/p,p=k,s&&(l=t-f)}}this.boxZone.left=l,this.boxZone.top=g,this.boxZone.width=f,this.boxZone.height=p,this.darkroom.canvas.bringToFront(this.boxZone),this.darkroom.dispatchEvent("box:update")}})}();