var JarokeloMap=function(){"use strict";function e(){var e=$("#report-create-form");e.length>0&&e.yiiActiveForm("validate")}function t(e,t,o){if("string"==typeof h[e]){var n=$(h[e]);n.val(t),o&&n.trigger("input")}}function o(){this.streetName="",this.streetNumber="",this.postCode="",this.formattedAddress="",this.latitude="",this.longitude="",this.significantName="",this.isAllFilled=function(){return""!==this.streetName&&""!==this.streetNumber&&""!==this.postCode&&""!==this.formattedAddress&&""!==this.latitude&&""!==this.longitude},this.isAllButStreetNumberFilled=function(){return""!==this.streetName&&""!==this.postCode&&""!==this.formattedAddress&&""!==this.latitude&&""!==this.longitude},this.removeCountryNameFromFormattedAddress=function(){var e="Magyarorsz√°g";this.streetName.includes(e)||(this.formattedAddress=this.formattedAddress.replace(e,"").replace("  "," "))}}function n(e){var t=new o;t.formattedAddress=e.formatted_address;for(var n=0;n<e.address_components.length&&!t.isAllFilled();++n)""===t.significantName&&(t.significantName=e.address_components[n].long_name),"route"===e.address_components[n].types[0]?t.streetName=e.address_components[n].long_name:"street_number"===e.address_components[n].types[0]?t.streetNumber=e.address_components[n].long_name:"postal_code"===e.address_components[n].types[0]&&(t.postCode=e.address_components[n].long_name),t.latitude=e.geometry.location.lat(),t.longitude=e.geometry.location.lng();return t}function a(e){var t=new o,a=new o;if(e.length>0){for(var r=new o,i=0;i<e.length&&!t.isAllFilled();++i){var s=n(e[i]);0===i&&(r=s),s.isAllFilled()?t=s:s.isAllButStreetNumberFilled()&&(a=s)}!t.isAllFilled()&&a.isAllButStreetNumberFilled()&&(t=a),""===r.significantName||t.formattedAddress.includes(r.significantName)||(t.formattedAddress+=" ("+r.significantName+")")}return t.removeCountryNameFromFormattedAddress(),t}function r(e,o){var n=a(e);t("address",n.streetName+" "+n.streetNumber),t("street_name",n.streetName),t("post_code",n.postCode,!0),t("user_location",n.formattedAddress,!0),"undefined"==typeof o&&(t("latitude",n.latitude),t("longitude",n.longitude))}function i(){"string"==typeof h.user_location&&(p=new google.maps.places.Autocomplete($(h.user_location)[0],{types:["address"],componentRestrictions:{country:"hu"}}),p.addListener("place_changed",function(){var e=p.getPlace();"undefined"!=typeof e.geometry&&w(e.geometry.location)}))}function s(e,t){var o=new google.maps.InfoWindow({map:u});o.setPosition(t),o.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}function l(e){t("latitude",e.latLng.lat()),t("longitude",e.latLng.lng()),w(e.latLng,!1)}var d,c,u,m,g,p,f=!1,h={map:null,zoom:null,show_on_map:null,show_me_on_map:null,latitude:null,longitude:null,user_location:null,post_code:null,street_name:null},_=null,v=function(e){g.setPosition(e),u.panTo(e),f!==!0&&u.setZoom(16)},y=function(e){h=e.selectors,d=e.zoom,c=e.center},w=function(e,t){m.geocode({location:e},function(o,n){n===google.maps.GeocoderStatus.OK&&o[0]&&(v(e),r(o,t))})},N=function(){$(h.show_on_map).on("click",function(){m.geocode({address:$(h.user_location).val()},function(t,o){o===google.maps.GeocoderStatus.OK&&t[0]&&(w(t[0].geometry.location),e())})}),$(h.show_me_on_map).on("click",function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};w(t)}):s(!1,u.getCenter())}),$(h.user_location).on("keydown",function(e){if(13===e.keyCode)return e.preventDefault(),void $(h.show_on_map).trigger("click")})},A=function(){y(window.mapInitData),"string"==typeof h.map&&(i(),u=new google.maps.Map($(h.map)[0],{center:c,zoom:d,mapTypeControl:!1,streetViewControl:!0,fullscreenControl:!0,scrollwheel:!0,draggable:!("ontouchend"in document)}),u.addListener("zoom_changed",function(){t("zoom",u.getZoom()),f=!0}),m=new google.maps.Geocoder,g=new google.maps.Marker({map:u,draggable:!0}),window.mapInitData.locationChangeHandler===!0&&(u.addListener("click",l),g.addListener("dragend",l)),N(),$(document).trigger("mapReady",u))},C=function(){A(),w(c,!1)},k=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.Circle({center:{lat:e.coords.latitude,lng:e.coords.longitude},radius:e.coords.accuracy});p.setBounds(t.getBounds())})};return{initMap:A,geolocate:k,showPlace:C,placeMarker:v,geocode:w,mapInitInterval:_}}();$(document).ready(function(){JarokeloMap.mapInitInterval=setInterval(function(){"undefined"!=typeof google&&"undefined"!=typeof google.maps&&"undefined"!=typeof google.maps.Map&&(clearInterval(JarokeloMap.mapInitInterval),JarokeloMap.mapInitInterval=null,JarokeloMap.showPlace())},250)});